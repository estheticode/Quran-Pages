<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø³ÙˆØ±Ø© Ø§Ù„Ø£Ø¹Ù„Ù‰</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
  body {
    font-family: 'Arial', sans-serif;
    background: #F4E4C1;
    color: #000;
    padding: 120px 20px 20px 20px; /* increased top padding for fixed header */
    text-align: center;
    direction: rtl;
    transition: background 0.3s, color 0.3s;
    max-width: 1000px;  
    margin: 0 auto;      
    box-sizing: border-box;
  }
  body.dark { background: #121212; color: #f0f0f0; }

  /* Fixed Progress bar at top */
  #progressBarContainer {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 6px;
    background: #ddd;
    border-radius: 3px;
    z-index: 9999;
  }
  body.dark #progressBarContainer { background: #333; }
  #progressBar {
    height: 100%;
    width: 0;
    background: green;
    border-radius: 3px;
    transition: width 0.3s;
  }

  /* Header */
  #header {
    position: fixed;
    top: 6px; /* below progress bar */
    left: 0;
    right: 0;
    margin: 0 auto;
    width: 100%;
    max-width: 1000px;
    padding: 10px 20px;
    background: #F4E4C1;
    z-index: 1000;
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    flex-wrap: wrap;
    box-sizing: border-box;
    direction: ltr; /* LTR for header */
  }
  body.dark #header { background: #121212; }

  /* Left side - dropdown and navigation */
  #leftSide {
    display: flex;
    flex-direction: column;
    gap: 10px;
    align-items: flex-start;
  }

  /* Navigation buttons below dropdown */
  #navButtons {
    display: flex;
    gap: 10px;
  }
  #navButtons button {
    padding: 6px 12px;
    font-size: 18px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    background: #e0e0e0;
    color: #000;
  }
  #navButtons button:hover { background: #d0d0d0; }
  body.dark #navButtons button { background: #333; color: #f0f0f0; }

  /* Custom dropdown container */
  #pageSelectContainer {
    position: relative;
    display: inline-block;
    cursor: pointer;
  }
  #pageSelectButton {
    padding: 6px 12px;
    font-size: 16px;
    border-radius: 6px;
    border: 1px solid #aaa;
    background: #fff;
  }
  body.dark #pageSelectButton { background:#222; color:#f0f0f0; border-color:#555; }

  #pageSelectOptions {
    position: fixed;
    background: #fff;
    border: 1px solid #aaa;
    border-radius: 6px;
    max-height: 200px;
    overflow-y: auto;
    z-index: 10000;
    display: none;
  }
  body.dark #pageSelectOptions { background:#222; color:#f0f0f0; border-color:#555; }

  #pageSelectOptions div {
    padding: 6px 12px;
  }
  #pageSelectOptions div:hover { background: #ddd; }
  body.dark #pageSelectOptions div:hover { background: #555; }

  /* Buttons container on right */
  #buttonsContainer {
    display: flex;
    gap: 10px;
    order: 1;
  }
  #buttonsContainer button {
    padding: 6px 12px;
    font-size: 18px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    background: #e0e0e0;
    color: #000;
  }
  #buttonsContainer button:hover { background: #d0d0d0; }
  body.dark #buttonsContainer button { background: #333; color: #f0f0f0; }

  h1#surahName { 
    font-size: 40px; 
    margin: 5px 0 5px 0;
  }
  .bismillah { 
    font-size: 26px; 
    font-weight: bold; 
    color: #555; 
    margin: 5px 0 20px 0;
  }
  body.dark .bismillah { color:#ccc; }
  
  /* Hide surah name and bismillah on pages other than first */
  body.not-first-page #surahName,
  body.not-first-page .bismillah {
    display: none;
  }

  #versesContainer { 
    max-width: 100%; 
    margin: 0 auto; 
    line-height: 2;
    transition: transform 0.05s ease-out, opacity 0.05s ease-out;
    transform-origin: center;
  }
  
  /* Page flip animation */
  @keyframes flipRight {
    0% {
      transform: perspective(1000px) rotateY(0deg);
      opacity: 1;
    }
    50% {
      transform: perspective(1000px) rotateY(-90deg);
      opacity: 0.3;
    }
    100% {
      transform: perspective(1000px) rotateY(0deg);
      opacity: 1;
    }
  }
  
  @keyframes flipLeft {
    0% {
      transform: perspective(1000px) rotateY(0deg);
      opacity: 1;
    }
    50% {
      transform: perspective(1000px) rotateY(90deg);
      opacity: 0.3;
    }
    100% {
      transform: perspective(1000px) rotateY(0deg);
      opacity: 1;
    }
  }
  
  #versesContainer.flipping-right {
    animation: flipRight 0.35s ease-in-out;
  }
  
  #versesContainer.flipping-left {
    animation: flipLeft 0.35s ease-in-out;
  }
  
  #versesContainer.dragging {
    transition: none;
  }

  .verse { font-size: 24px; margin: 12px 0; display: inline; position: relative; }
  .verse-number { color: green; font-weight: bold; margin-left: 8px; cursor: pointer; }
  body.dark .verse-number { color: #4ade80; }

  /* Fixed popover near button */
  .popover {
    display: none;
    position: fixed;          
    background-color: #fff;
    color: #000;
    border: 1px solid #aaa;
    border-radius: 8px;
    padding: 10px 14px;
    box-shadow: 0 3px 10px rgba(0,0,0,0.25);
    z-index: 9999;
    font-size: 16px;
    max-width: 280px;
    text-align: left;
    line-height: 1.4;
    direction: ltr;
  }
  body.dark .popover { background:#222; color:#f0f0f0; border-color:#555; }

  @media (max-width: 500px) {
    h1#surahName { font-size: 32px; }
    .bismillah { font-size: 20px; margin-bottom: 15px; }
    .verse { font-size: 20px; }
    #buttonsContainer button { font-size: 16px; padding: 5px 10px; }
    #pageSelectButton { font-size: 14px; padding: 5px 10px; }
  }
</style>
</head>
<body>

<div id="progressBarContainer"><div id="progressBar"></div></div>

<div id="header">
  <!-- Left side: dropdown and navigation buttons -->
  <div id="leftSide">
    <div id="pageSelectContainer">
      <div id="pageSelectButton">Page 1 â–¼</div>
      <div id="pageSelectOptions"></div>
    </div>
    <div id="navButtons">
      <button id="nextPage">â—€</button>
      <button id="prevPage">â–¶</button>
    </div>
  </div>

  <!-- Right side: theme and font buttons -->
  <div id="buttonsContainer">
    <button id="fontDecrease">âˆ’</button>
    <button id="fontIncrease">+</button>
    <button id="themeBtn">ğŸŒ™</button>
  </div>
</div>

<h1 id="surahName">Ø§Ù„Ø£Ø¹Ù„Ù‰</h1>
<div class="bismillah">Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ†Ù Ø§Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù</div>

<div id="versesContainer"></div>

<script>
const tg = window.Telegram?.WebApp;
if (tg) tg.ready();

const surahData = {
  name: "Ø§Ù„Ø£Ø¹Ù„Ù‰",
  englishName: "Alâ€‘A'la (The Most High)",
  verses: [
    {arabic: "Ø³ÙØ¨ÙÙ‘Ø­Ù Ø§Ø³Ù’Ù…Ù Ø±ÙØ¨ÙÙ‘ÙƒÙ Ø§Ù„Ù’Ø£ÙØ¹Ù’Ù„ÙÙ‰", translation: "Exalt the name of your Lord, the Most High,"},
    {arabic: "Ø§Ù„ÙÙ‘Ø°ÙÙŠ Ø®ÙÙ„ÙÙ‚Ù ÙÙØ³ÙÙˆÙÙ‘Ù‰Ù°", translation: "Who created and proportioned,"},
    {arabic: "ÙˆÙØ§Ù„ÙÙ‘Ø°ÙÙŠ Ù‚ÙØ¯ÙÙ‘Ø±Ù ÙÙÙ‡ÙØ¯ÙÙ‰Ù°", translation: "And Who destined and [then] guided,"},
    {arabic: "ÙˆÙØ§Ù„ÙÙ‘Ø°ÙÙŠ Ø£ÙØ®Ù’Ø±ÙØ¬Ù Ø§Ù„Ù’Ù…ÙØ±Ù’Ø¹ÙÙ‰Ù°", translation: "And Who brings out the pasture,"},
    {arabic: "ÙÙØ¬ÙØ¹ÙÙ„ÙÙ‡Ù ØºÙØ«ÙØ§Ø¡Ù‹ Ø£ÙØ­Ù’ÙˆÙÙ‰Ù°", translation: "And [then] makes it black stubble."},
    {arabic: "Ø³ÙÙ†ÙÙ‚Ù’Ø±ÙØ¦ÙÙƒÙ ÙÙÙ„ÙØ§ ØªÙÙ†Ù’Ø³ÙÙ‰Ù°", translation: "We will make you recite, [O Muhammad], and you will not forget,"},
    {arabic: "Ø¥ÙÙ„ÙÙ‘Ø§ Ù…ÙØ§ Ø´ÙØ§Ø¡Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ûš Ø¥ÙÙ†ÙÙ‘Ù‡Ù ÙŠÙØ¹Ù’Ù„ÙÙ…Ù Ø§Ù„Ù’Ø¬ÙÙ‡Ù’Ø±Ù ÙˆÙÙ…ÙØ§ ÙŠÙØ®Ù’ÙÙÙ‰Ù°", translation: "Except what Allah should will. Indeed, He knows what is declared and what is hidden."},
    {arabic: "ÙˆÙÙ†ÙÙŠÙØ³ÙÙ‘Ø±ÙÙƒÙ Ù„ÙÙ„Ù’ÙŠÙØ³Ù’Ø±ÙÙ‰Ù°", translation: "And We will ease you toward ease."},
    {arabic: "ÙÙØ°ÙÙƒÙÙ‘Ø±Ù’ Ø¥ÙÙ†Ù’ Ù†ÙÙÙØ¹ÙØªÙ Ø§Ù„Ø°ÙÙ‘ÙƒÙ’Ø±ÙÙ‰Ù°", translation: "So remind, if the reminder should benefit;"},
    {arabic: "Ø³ÙÙŠÙØ°ÙÙ‘ÙƒÙÙ‘Ø±Ù Ù…ÙÙ†Ù’ ÙŠÙØ®Ù’Ø´ÙÙ‰Ù°", translation: "He who fears [Allah] will be reminded."},
    {arabic: "ÙˆÙÙŠÙØªÙØ¬ÙÙ†ÙÙ‘Ø¨ÙÙ‡ÙØ§ Ø§Ù„Ù’Ø£ÙØ´Ù’Ù‚ÙÙ‰Ù°", translation: "But the wretched one will avoid itâ€”"},
    {arabic: "Ø§Ù„ÙÙ‘Ø°ÙÙŠ ÙŠÙØµÙ’Ù„ÙÙ‰Ù° Ø§Ù„Ù†ÙÙ‘Ø§Ø±Ù Ø§Ù„Ù’ÙƒÙØ¨Ù’Ø±ÙÙ‰Ù°", translation: "[He] who will [enter and] burn in the greatest Fire,"},
    {arabic: "Ø«ÙÙ…ÙÙ‘ Ù„ÙØ§ ÙŠÙÙ…ÙÙˆØªÙ ÙÙÙŠÙ‡ÙØ§ ÙˆÙÙ„ÙØ§ ÙŠÙØ­Ù’ÙŠÙÙ‰Ù°", translation: "Then therein he shall neither die nor live."},
    {arabic: "Ù‚ÙØ¯Ù’ Ø£ÙÙÙ’Ù„ÙØ­Ù Ù…ÙÙ†Ù’ ØªÙØ²ÙÙƒÙÙ‘Ù‰Ù°", translation: "He has certainly succeeded who purifies himself,"},
    {arabic: "ÙˆÙØ°ÙÙƒÙØ±Ù Ø§Ø³Ù’Ù…Ù Ø±ÙØ¨ÙÙ‘Ù‡Ù ÙÙØµÙÙ„ÙÙ‘Ù‰Ù°", translation: "And mentions the name of his Lord and prays."},
    {arabic: "Ø¨ÙÙ„Ù’ ØªÙØ¤Ù’Ø«ÙØ±ÙÙˆÙ†Ù Ø§Ù„Ù’Ø­ÙÙŠÙØ§Ø©Ù Ø§Ù„Ø¯ÙÙ‘Ù†Ù’ÙŠÙØ§", translation: "But you prefer the worldly life,"},
    {arabic: "ÙˆÙØ§Ù„Ù’Ø¢Ø®ÙØ±ÙØ©Ù Ø®ÙÙŠÙ’Ø±ÙŒ ÙˆÙØ£ÙØ¨Ù’Ù‚ÙÙ‰Ù°", translation: "While the Hereafter is better and more enduring."},
    {arabic: "Ø¥ÙÙ†ÙÙ‘ Ù‡ÙÙ°Ø°ÙØ§ Ù„ÙÙÙÙŠ Ø§Ù„ØµÙÙ‘Ø­ÙÙÙ Ø§Ù„Ù’Ø£ÙÙˆÙ„ÙÙ‰Ù°", translation: "Indeed, this is in the former scripturesâ€”"},
    {arabic: "ØµÙØ­ÙÙÙ Ø¥ÙØ¨Ù’Ø±ÙØ§Ù‡ÙÙŠÙ…Ù ÙˆÙÙ…ÙÙˆØ³ÙÙ‰Ù°", translation: "The scriptures of Abraham and Moses."}
  ]
};

const maxVersesPerPage = 16;
const totalPages = Math.ceil(surahData.verses.length / maxVersesPerPage);
const pages = [];
for(let i=0; i<totalPages; i++){
  pages.push(surahData.verses.slice(i*maxVersesPerPage, (i+1)*maxVersesPerPage));
}

const pageSelectButton = document.getElementById('pageSelectButton');
const pageSelectOptions = document.getElementById('pageSelectOptions');
let currentPage = 0;

// Populate custom dropdown options
for(let i=0; i<totalPages; i++){
  const option = document.createElement('div');
  option.textContent = "Page " + (i+1);
  option.dataset.index = i;
  pageSelectOptions.appendChild(option);

  option.addEventListener('click', ()=>{
    const direction = i > currentPage ? 'next' : (i < currentPage ? 'prev' : 'none');
    goToPage(i, direction);
    pageSelectOptions.style.display = "none";
  });
}

// toggle dropdown visibility
pageSelectButton.addEventListener('click', (e)=>{
  e.stopPropagation();
  const isVisible = pageSelectOptions.style.display === "block";
  pageSelectOptions.style.display = isVisible ? "none" : "block";
  
  if(!isVisible) {
    // Position dropdown below button
    const rect = pageSelectButton.getBoundingClientRect();
    pageSelectOptions.style.top = (rect.bottom + 2) + "px";
    pageSelectOptions.style.left = rect.left + "px";
  }
});

// hide dropdown if clicking outside
document.addEventListener('click', e=>{
  if(!pageSelectButton.contains(e.target) && !pageSelectOptions.contains(e.target)){
    pageSelectOptions.style.display = "none";
  }
});

// Progress bar update function
function updateProgressBar() {
  document.getElementById('progressBar').style.width = ((currentPage+1)/totalPages*100) + "%";
}

let currentFontSize = 24;
const versesContainer = document.getElementById('versesContainer');

function displayVerses(pageIndex=0){
  versesContainer.innerHTML = "";
  pages[pageIndex].forEach((verse, idx)=>{
    const verseDiv = document.createElement('div');
    verseDiv.className = "verse";
    verseDiv.style.fontSize = currentFontSize + "px";
    const verseNumber = pageIndex*maxVersesPerPage + idx + 1;
    verseDiv.innerHTML = `
      ${verse.arabic} <span class="verse-number" data-index="${verseNumber-1}">[${verseNumber}]</span>
      <div class="popover" id="popover-${verseNumber-1}">${verse.translation}</div>
    `;
    versesContainer.appendChild(verseDiv);
  });

  document.querySelectorAll('.verse-number').forEach(el=>{
    el.addEventListener('click', (e)=>{
      e.stopPropagation();
      const idx = el.dataset.index;
      const pop = document.getElementById('popover-' + idx);

      // hide other popovers
      document.querySelectorAll('.popover').forEach(p=>{
        if(p!==pop) p.style.display='none';
      });

      if(pop.style.display==='block'){
        pop.style.display='none';
        return;
      }

      // position popover near button (fixed, ignores body margins)
      const rect = el.getBoundingClientRect();
      pop.style.top = (rect.bottom + window.scrollY + 8) + "px";
      pop.style.left = rect.left + "px";

      // keep inside viewport horizontally
      setTimeout(() => {
        const popRect = pop.getBoundingClientRect();
        if(popRect.right > window.innerWidth - 8){
          pop.style.left = (window.innerWidth - popRect.width - 8) + "px";
        }
        if(popRect.left < 8) {
          pop.style.left = "8px";
        }
      }, 0);

      pop.style.display='block';
    });
  });

  document.addEventListener('click', e=>{
    if(!e.target.classList.contains('verse-number')){
      document.querySelectorAll('.popover').forEach(p=>p.style.display='none');
    }
  });
}

// Initial display
displayVerses(0);
updateProgressBar();

// Swipe functionality (touch and mouse) with live feedback
let startX = 0;
let startY = 0;
let currentX = 0;
let isDragging = false;
let isMoving = false;
const minSwipe = 60;
const swipeThreshold = 120; // Distance needed to trigger page change

// Touch events
document.addEventListener('touchstart', e => {
  // Don't start drag if touching buttons, dropdowns, or popovers
  if(e.target.closest('#header') || e.target.closest('.popover')) return;
  
  startX = e.touches[0].clientX;
  startY = e.touches[0].clientY;
  currentX = startX;
  isMoving = true;
  versesContainer.classList.add('dragging');
});

document.addEventListener('touchmove', e => {
  if(!isMoving) return;
  
  currentX = e.touches[0].clientX;
  const dx = currentX - startX;
  const dy = e.touches[0].clientY - startY;
  
  // Only apply effect if horizontal movement is greater
  if(Math.abs(dx) > Math.abs(dy)) {
    e.preventDefault();
    applyDragEffect(dx);
  }
});

document.addEventListener('touchend', e => {
  if(!isMoving) return;
  
  const endX = e.changedTouches[0].clientX;
  const endY = e.changedTouches[0].clientY;
  
  versesContainer.classList.remove('dragging');
  resetDragEffect();
  isMoving = false;
  
  handleSwipe(startX, startY, endX, endY);
});

// Mouse events
document.addEventListener('mousedown', e => {
  // Don't start drag if clicking on buttons, dropdowns, or popovers
  if(e.target.closest('#header') || e.target.closest('.popover')) return;
  
  isDragging = true;
  startX = e.clientX;
  startY = e.clientY;
  currentX = startX;
  document.body.style.cursor = 'grabbing';
  versesContainer.classList.add('dragging');
});

document.addEventListener('mousemove', e => {
  if(!isDragging) return;
  
  currentX = e.clientX;
  const dx = currentX - startX;
  const dy = e.clientY - startY;
  
  // Only apply effect if horizontal movement is greater
  if(Math.abs(dx) > Math.abs(dy)) {
    e.preventDefault();
    applyDragEffect(dx);
  }
});

document.addEventListener('mouseup', e => {
  if(!isDragging) return;
  
  isDragging = false;
  document.body.style.cursor = 'default';
  
  const endX = e.clientX;
  const endY = e.clientY;
  
  versesContainer.classList.remove('dragging');
  resetDragEffect();
  
  handleSwipe(startX, startY, endX, endY);
});

// Apply visual feedback during drag
function applyDragEffect(dx) {
  // Limit the drag effect
  const maxDrag = 80;
  const limitedDx = Math.max(-maxDrag, Math.min(maxDrag, dx));
  
  // Calculate rotation and opacity based on drag distance
  const rotationY = (limitedDx / maxDrag) * 12; // Max 12 degrees
  const opacity = 1 - (Math.abs(limitedDx) / maxDrag) * 0.25; // Max 25% fade
  
  versesContainer.style.transform = `perspective(1000px) rotateY(${rotationY}deg)`;
  versesContainer.style.opacity = opacity;
}

// Reset visual feedback
function resetDragEffect() {
  versesContainer.style.transform = '';
  versesContainer.style.opacity = '';
}

// Handle swipe logic
function handleSwipe(startX, startY, endX, endY) {
  const dx = endX - startX;
  const dy = endY - startY;
  
  // Only swipe if horizontal movement is greater than vertical
  if(Math.abs(dx) > Math.abs(dy) && Math.abs(dx) > minSwipe){
    if(dx > 0) {
      // Swipe right - go to next page (RTL)
      goToPage(currentPage + 1, 'next');
    } else {
      // Swipe left - go to previous page (RTL)
      goToPage(currentPage - 1, 'prev');
    }
  }
}

// Helper function to navigate to a page
function goToPage(pageIndex, direction = 'none') {
  if(pageIndex < 0 || pageIndex >= totalPages) return;
  
  // Add flip animation
  versesContainer.classList.remove('flipping-right', 'flipping-left');
  
  if(direction === 'next') {
    versesContainer.classList.add('flipping-right');
  } else if(direction === 'prev') {
    versesContainer.classList.add('flipping-left');
  }
  
  // Wait a bit before updating content for smoother animation
  setTimeout(() => {
    currentPage = pageIndex;
    displayVerses(pageIndex);
    updateProgressBar();
    pageSelectButton.textContent = "Page " + (pageIndex + 1) + " â–¼";
    
    // Show/hide surah name and bismillah based on page
    if(pageIndex === 0) {
      document.body.classList.remove('not-first-page');
    } else {
      document.body.classList.add('not-first-page');
    }
  }, direction === 'none' ? 0 : 175);
  
  // Remove animation class after animation completes
  setTimeout(() => {
    versesContainer.classList.remove('flipping-right', 'flipping-left');
  }, 350);
}

// Navigation button click handlers
document.getElementById('nextPage').addEventListener('click', () => {
  goToPage(currentPage + 1, 'next');
});

document.getElementById('prevPage').addEventListener('click', () => {
  goToPage(currentPage - 1, 'prev');
});

const themeBtn = document.getElementById('themeBtn');
themeBtn.addEventListener('click', ()=>{
  document.body.classList.toggle('dark');
  themeBtn.textContent = document.body.classList.contains('dark') ? "â˜€ï¸" : "ğŸŒ™";
});

document.getElementById('fontIncrease').addEventListener('click', ()=>{
  if(currentFontSize < 40){ 
    currentFontSize += 2; 
    displayVerses(currentPage); 
  }
});
document.getElementById('fontDecrease').addEventListener('click', ()=>{
  if(currentFontSize > 14){ 
    currentFontSize -= 2; 
    displayVerses(currentPage); 
  }
});
</script>

</body>
</html>
